box: alpine

build:
  steps:
  - script:
    name: Install dependencies.
    code: apk add --no-cache zip
  - script:
    name: Packing.
    code: |
      cd evil-magic
      zip -0 ../em.epub mimetype
      zip -r -9 ../em.epub META-INF OEBPS
deploy:
  steps:
  - script:
    name: Install dependencies.
    code: apk add --no-cache curl file
  - script:
    name: Generate timestamp.
    code: export APPVER=$(date "+%Y%m%d-%H%M")
  - github-create-release:
    token: ${GITHUB_TOKEN}
    tag: ${APPVER}
  - github-upload-asset:
    token: ${GITHUB_TOKEN}
    file: em.epub
    filename: evil-magic-${APPVER}.epub