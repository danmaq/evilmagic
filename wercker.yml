box: alpine

build:
  steps:
  - script:
    name: Install dependencies.
    code: apk add --no-cache curl git openssh-client zip
  - script:
    name: Packing.
    code: |
      cd evil-magic
      zip -0 ../em.epub mimetype
      zip -r -9 ../em.epub META-INF OEBPS
deploy:
  steps:
  - script:
    name: Install dependencies.
    code: apk add --no-cache curl git openssh-client zip
  - script:
    name: Generate timestamp.
    code: export APPVER=$(date "+%Y%m%d-%H%M")
  - script:
    name: Rename.
    code: ls && cp em.epub evil-magic-${APPVER}.epub && ls && pwd
  - github-create-release:
    token: ${GITHUB_TOKEN}
    tag: ${APPVER}
  - github-upload-asset:
    token: ${GITHUB_TOKEN}
    file: evil-magic-${APPVER}.epub